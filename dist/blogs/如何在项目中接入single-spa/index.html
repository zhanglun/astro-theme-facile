<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="canonical" href="https://https/astro-theme-facile/blogs/%E5%A6%82%E4%BD%95%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%8E%A5%E5%85%A5single-spa/">
    <meta name="generator" content="Astro v1.9.1">

    <!-- General Meta Tags -->
    <title>如何在项目中接入single-spa</title>
    <meta name="title" content="如何在项目中接入single-spa">
    <meta name="description" content="之前的文章single-spa源码解析-registerApplication和start中，对single-spa提供的两个关键方法的源码进行了简单分析。">
    <meta name="author" content="zhanglun">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="如何在项目中接入single-spa">
    <meta property="og:description" content="之前的文章single-spa源码解析-registerApplication和start中，对single-spa提供的两个关键方法的源码进行了简单分析。">
    <meta property="og:url" content="https://https/astro-theme-facile/blogs/%E5%A6%82%E4%BD%95%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%8E%A5%E5%85%A5single-spa/">
    <meta property="og:image" content="https://https/%E5%A6%82%E4%BD%95%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%8E%A5%E5%85%A5single-spa.svg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://https/astro-theme-facile/blogs/%E5%A6%82%E4%BD%95%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%8E%A5%E5%85%A5single-spa/">
    <meta property="twitter:title" content="如何在项目中接入single-spa">
    <meta property="twitter:description" content="之前的文章single-spa源码解析-registerApplication和start中，对single-spa提供的两个关键方法的源码进行了简单分析。">
    <meta property="twitter:image" content="https://https/astropaper-og.jpg">

    <!-- Google Font -->
    <!-- <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    /> -->

    

    <script src="/toggle-theme.js"></script>
  <link rel="stylesheet" href="/astro-theme-facile/assets/about.f0b2d10e.css" />
<link rel="stylesheet" href="/astro-theme-facile/assets/_slug_.7bc150a9.css" />
<link rel="stylesheet" href="/astro-theme-facile/assets/_slug_.5beba882.css" />
<link rel="stylesheet" href="/astro-theme-facile/assets/about.2a036302.css" />
<link rel="stylesheet" href="/astro-theme-facile/assets/_slug_.f0163f61.css" />
<link rel="stylesheet" href="/astro-theme-facile/assets/_slug_.80516c5d.css" />
<link rel="stylesheet" href="/astro-theme-facile/assets/_slug_.4fac2f80.css" /><script type="module">const e=document.querySelector(".hamburger-menu"),n=document.querySelector("#menu-items")?.classList,t=document.querySelector(".icon-container")?.classList,o=document.querySelector("#first-line")?.classList,a=document.querySelector("#second-line ")?.classList,s=document.querySelector("#third-line")?.classList;e.addEventListener("click",function(r){e?.getAttribute("aria-expanded")==="false"?(e?.setAttribute("aria-expanded","true"),e?.setAttribute("aria-label","Close Menu"),n?.remove("display-none"),t?.remove("flex"),t?.add("relative"),o?.add("rotate-45","absolute","bottom-1/2"),s?.add("display-none"),a?.add("!w-full","-rotate-45","absolute","bottom-1/2")):(e?.setAttribute("aria-expanded","false"),e?.setAttribute("aria-label","Open Menu"),n?.add("display-none"),t?.add("flex"),t?.remove("relative"),o?.remove("rotate-45","absolute","bottom-1/2"),s?.remove("display-none"),a?.remove("!w-full","-rotate-45","absolute","bottom-1/2"))});
</script></head>
  <body>
    <header class="astro-ZEJXROEC">
  <a id="skip-to-content" href="#main-content" class="astro-ZEJXROEC">Skip to content</a>
  <div class="nav-container astro-ZEJXROEC">
    <div class="top-nav-wrap astro-ZEJXROEC">
      <a href="/" class="logo astro-ZEJXROEC">
        Astro blog facile
      </a>
      <nav id="nav-menu" class="astro-ZEJXROEC">
        <button class="hamburger-menu focus-outline astro-ZEJXROEC" aria-label="Open Menu" aria-expanded="false" aria-controls="menu-items">
          <div class="icon-container flex astro-ZEJXROEC">
            <div id="first-line" class="astro-ZEJXROEC"></div>
            <div id="second-line" class="astro-ZEJXROEC"></div>
            <div id="third-line" class="astro-ZEJXROEC"></div>
          </div>
        </button>
        <ul id="menu-items" class="display-none sm:flex astro-ZEJXROEC">
          <li class="astro-ZEJXROEC">
                <a class=" astro-ZEJXROEC" href="/astro-theme-facile/">
                  <span class="astro-ZEJXROEC">首页</span>
                </a>
              </li><li class="astro-ZEJXROEC">
                <a class=" astro-ZEJXROEC" href="/astro-theme-facile/blogs">
                  <span class="astro-ZEJXROEC">博文</span>
                </a>
              </li><li class="astro-ZEJXROEC">
                <a class=" astro-ZEJXROEC" href="/astro-theme-facile/categories">
                  <span class="astro-ZEJXROEC">分类</span>
                </a>
              </li><li class="astro-ZEJXROEC">
                <a class=" astro-ZEJXROEC" href="/astro-theme-facile/archives">
                  <span class="astro-ZEJXROEC">归档</span>
                </a>
              </li><li class="astro-ZEJXROEC">
                <a class=" astro-ZEJXROEC" href="/astro-theme-facile/labs">
                  <span class="astro-ZEJXROEC">实验室</span>
                </a>
              </li><li class="astro-ZEJXROEC">
                <a class=" astro-ZEJXROEC" href="/astro-theme-facile/about">
                  <span class="astro-ZEJXROEC">关于我</span>
                </a>
              </li>
          <li class="astro-ZEJXROEC">
            <a type="button" href="/astro-theme-facile/search" tabindex="0" class="group focus-outline p-3 sm:p-1  astro-ZEJXROEC astro-2C5NGGNE" aria-label="search" title="Search">
  <svg xmlns="http://www.w3.org/2000/svg" class="scale-125 sm:scale-100 astro-ZEJXROEC"><path d="M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z" class="astro-ZEJXROEC"></path>
              </svg>
</a>


          </li>
          <li class="astro-ZEJXROEC">
            <button id="theme-btn" class="focus-outline astro-ZEJXROEC" title="Toggles light & dark" aria-label="auto" aria-live="polite">
                  <svg xmlns="http://www.w3.org/2000/svg" id="moon-svg" class="astro-ZEJXROEC">
                    <path d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z" class="astro-ZEJXROEC"></path>
                  </svg>
                  <svg xmlns="http://www.w3.org/2000/svg" id="sun-svg" class="astro-ZEJXROEC">
                    <path d="M6.993 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007S14.761 6.993 12 6.993 6.993 9.239 6.993 12zM12 8.993c1.658 0 3.007 1.349 3.007 3.007S13.658 15.007 12 15.007 8.993 13.658 8.993 12 10.342 8.993 12 8.993zM10.998 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2h-3zm17 0h3v2h-3zM4.219 18.363l2.12-2.122 1.415 1.414-2.12 2.122zM16.24 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.342 7.759 4.22 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z" class="astro-ZEJXROEC"></path>
                  </svg>
                </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</header>



<div class="max-w-3xl mx-auto w-full px-2 flex justify-start astro-LRLIQ33U">
    <button class="mt-8 mb-2 hover:opacity-75 flex focus-outline astro-LRLIQ33U" onclick="history.back()">
      <svg xmlns="http://www.w3.org/2000/svg" class="astro-LRLIQ33U"><path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" class="astro-LRLIQ33U"></path>
      </svg><span class="astro-LRLIQ33U">Go back</span>
    </button>
  </div><main id="main-content" class="astro-LRLIQ33U">
    <h1 class="post-title astro-LRLIQ33U">如何在项目中接入single-spa</h1>
    <div class="opacity-80 flex items-center space-x-2 my-2 astro-LRLIQ33U"><svg xmlns="http://www.w3.org/2000/svg" class="scale-100 w-6 h-6 inline-block fill-skin-base" aria-hidden="true"><path d="M7 11h2v2H7zm0 4h2v2H7zm4-4h2v2h-2zm0 4h2v2h-2zm4-4h2v2h-2zm0 4h2v2h-2z"></path><path d="M5 22h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2zM19 8l.001 12H5V8h14z"></path></svg><span class="sr-only">Posted on:</span><span class="italic text-base">November 28, 2020<span aria-hidden="true"> | </span><span class="sr-only"> at </span>08:27 PM</span></div>
    <article id="article" role="article" class="mx-auto max-w-3xl mt-8 prose astro-LRLIQ33U">
      <p>之前的文章<a href="../single-spa%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-registerapplication%E5%92%8Cstart">single-spa源码解析-registerApplication和start</a>中，对single-spa提供的两个关键方法的源码进行了简单分析。今天来讲一讲如何在项目中接入使用。</p>
<p>要创建一个single-spa应用程序，需要做三件事：</p>
<h2 id="创建一个-html-文件">创建一个 html 文件</h2>
<p>这个文件的目的就是加载single-spa的 config 配置，调用 <code>registerApplication()</code> 方法。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF">></span></span>
<span class="line"><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">></span></span>
<span class="line"><span style="color: #ABB2BF">	&#x3C;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">src</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">"single-spa-config.js"</span><span style="color: #ABB2BF">>&#x3C;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">></span></span>
<span class="line"><span style="color: #ABB2BF">&#x3C;/</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">></span></span>
<span class="line"><span style="color: #ABB2BF">&#x3C;/</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF">></span></span></code></pre>
<h2 id="创建一个single-spa-config">创建一个single-spa-config。</h2>
<p>只有先注册应用，single—spa才能知道在什么时机，如何初始化、下载、挂载和卸载对应的应用。通常会在配置文件中将应用注册。通过调用<code>registerApplication</code>方法来注册应用。例如：</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #7F848E">// single-spa-config.js</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">registerApplication</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">start</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'single-spa'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #7F848E">// Simple usage</span></span>
<span class="line"><span style="color: #61AFEF">registerApplication</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #98C379">'app2'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'src/app2/main.js'</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75">location</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">location</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">pathname</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">startsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'/app2'</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">  { </span><span style="color: #E06C75">some</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'value'</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #7F848E">// Config with more expressive API</span></span>
<span class="line"><span style="color: #61AFEF">registerApplication</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'app1'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">app</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'src/app1/main.js'</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">activeWhen</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'/app1'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">customProps</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">some</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'value'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #61AFEF">start</span><span style="color: #ABB2BF">();</span></span></code></pre>
<h3 id="参数">参数</h3>
<h4 id="name">name</h4>
<p><code>registerApplication</code>的第一个参数表示应用名称，<code>name</code>必须是string类型</p>
<h4 id="loading-function-or-application">Loading Function or Application</h4>
<p><code>registerApplication</code>可以是一个Promise类型的 <a href="configuration#loading-function">加载函数</a>，也可以是一个已经被解析的应用。</p>
<h5 id="application-as-second-argument">Application as second argument</h5>
<p>你可以选择将一个已经被解析过的应用作为<code>registerApplication</code>的第二个参数，这个应用其实是一个包含各个生命周期函数的对象。我们既可以从另外一个文件中引入该对象，也可以在single-spa的配置文件中定义这个对象。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">application</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">bootstrap</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(), </span><span style="color: #7F848E">//bootstrap function</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(), </span><span style="color: #7F848E">//mount function</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">unmount</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(), </span><span style="color: #7F848E">//unmount function</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #61AFEF">registerApplication</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'applicationName'</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">application</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">activityFunction</span><span style="color: #ABB2BF">)</span></span></code></pre>
<h5 id="加载函数">加载函数</h5>
<p><code>registerApplication</code>的第二个参数必须是返回promise的函数(或<a href="https://ponyfoo.com/articles/understanding-javascript-async-await">“async function”</a>方法)。这个函数没有入参，会在应用第一次被下载时调用。返回的Promise resolve之后的结果必须是一个可以被解析的应用。常见的实现方法是使用import加载：<code>() => import('/path/to/application.js')</code></p>
<h4 id="激活函数">激活函数</h4>
<p><code>registerApplication</code>的第三个参数需要是一个纯函数，<code>window.location</code>会作为第一个参数被调用，当函数返回的值为真(truthy)值时，应用会被激活。通常情况下，Activity function会根据<code>window.location</code>/后面的path来决定该应用是否需要被激活。
另外一种场景是single-spa根据顶级路由查找应用，而每个应用会处理自身的子路由。 在以下场景，single-spa会调用应用的activity function</p>
<p>在以下情况下，single-spa将调用每个应用的活动函数：</p>
<ul>
<li><code>hashchange</code> or <code>popstate</code>事件触发时</li>
<li><code>pushState</code> or <code>replaceState</code>被调用时</li>
<li>在single-spa上手动调用[<code>triggerAppChange</code>] 方法</li>
<li><code>checkActivityFunctions</code>方法被调用时</li>
</ul>
<h4 id="自定义属性">自定义属性</h4>
<p><code>registerApplication</code>函数可选的第四个参数是 <a href="/docs/building-applications/#custom-props">custom props</a>。这个参数会传递给 single-spa 的 <code>lifecycle</code> 函数。自定义属性可以是一个对象，也可以是一个返回Object的函数。如果自定属性是一个函数，函数的参数是应用的名字（application name)和当前<code>window.location</code>。</p>
<h3 id="使用对象参数">使用对象参数</h3>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #E5C07B">singleSpa</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">registerApplication</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'myApp'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">app</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'src/myApp/main.js'</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">activeWhen</span><span style="color: #ABB2BF">: [</span><span style="color: #98C379">'/myApp'</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75">location</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">location</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">pathname</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">startsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'/some/other/path'</span><span style="color: #ABB2BF">)],</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">customProps</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">some</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'value'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">singleSpa</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">registerApplication</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'myApp'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">app</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'src/myApp/main.js'</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">activeWhen</span><span style="color: #ABB2BF">: [</span><span style="color: #98C379">'/myApp'</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75">location</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">location</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">pathname</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">startsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'/some/other/path'</span><span style="color: #ABB2BF">)],</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">customProps</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">location</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> ({</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">some</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'value'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  }),</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<h4 id="configname">config.name</h4>
<p>必须是字符串。</p>
<h4 id="configapp">config.app</h4>
<p>应用的定义，它可以是一个单spa生命周期的对象，加载函数或者与第二个参数相同。</p>
<h4 id="configactivewhen">config.activeWhen</h4>
<p>可以是激活函数，比如参数API、路径前缀或两者的数组。因为最常见的用例是使用<code>window.location</code> 将其URL前缀进行匹配，所以我们帮你实现了这个方法。</p>
<h4 id="path-prefix">Path prefix</h4>
<p>路径前缀会匹配url，允许以下每一种前缀：</p>
<dl>
  <dt>'/app1'</dt>
  <dd>✅ https://app.com/app1</dd>
  <dd>✅ https://app.com/app1/anything/everything</dd>
  <dd>🚫 https://app.com/app2</dd>
  <dt>'/users/:userId/profile'</dt>
  <dd>✅ https://app.com/users/123/profile</dd>
  <dd>✅ https://app.com/users/123/profile/sub-profile/</dd>
  <dd>🚫 https://app.com/users//profile/sub-profile/</dd>
  <dd>🚫 https://app.com/users/profile/sub-profile/</dd>
  <dt>'/pathname/#/hash'</dt>
  <dd>✅ https://app.com/pathname/#/hash</dd>
  <dd>✅ https://app.com/pathname/#/hash/route/nested</dd>
  <dd>🚫 https://app.com/pathname#/hash/route/nested</dd>
  <dd>🚫 https://app.com/pathname#/another-hash</dd>
  <dt>['/pathname/#/hash', '/app1']</dt>
  <dd>✅ https://app.com/pathname/#/hash/route/nested</dd>
  <dd>✅ https://app.com/app1/anything/everything</dd>
  <dd>🚫 https://app.com/pathname/app1</dd>
  <dd>🚫 https://app.com/app2</dd>
</dl>
<h4 id="自定义属性-1">自定义属性</h4>
<p><code>registerApplication</code>函数可选的第四个参数是 <a href="/docs/building-applications/#custom-props">custom props</a>。这个参数会传递给 single-spa 的 <code>lifecycle</code> 函数。自定义属性可以是一个对象，也可以是一个返回Object的函数。如果自定属性是一个函数，函数的参数是应用的名字（application name)和当前<code>window.location</code></p>
<h2 id="调用-singlespastart">调用 singleSpa.start()</h2>
<p><a href="api.md#start"><code>start()方法</code></a> <strong>必须</strong>被single-spa配置文件的js调用，这时应用才会被真正挂载。在<code>start</code>被调用之前，应用先被下载，但不会初始化/挂载/卸载。<code>start</code>方法可以协助我们更好提升应用的性能。举个例子，我们可能会马上注册一个应用(为了立刻下载代码)，但不能马上就在DOM节点上挂载该应用，而是需要等一个AJAX请求(可能会获取用户的登录信息)完成后，再根据结果进行挂载。这种情况下，最佳实践是先调用<code>registerApplication</code>，等AJAX请求完成后再调用<code>start</code>。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #7F848E">//single-spa-config.js</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">start</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'single-spa'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E">/*在注册应用之前调用start意味着single-spa可以立即安装应用，无需等待单页应用的任何初始设置。*/</span></span>
<span class="line"><span style="color: #61AFEF">start</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #7F848E">// 注册应用。。。。</span></span></code></pre>
<h2 id="创建一个应用程序">创建一个应用程序。</h2>
<p>single-spa 应用与普通的单页面是一样的，只不过它没有HTML页面。在一个single-spa中，可以包含许多被注册的应用，而各个应用可以使用不同的框架。被注册的这些应用维护自己的客户端路由，使用自己需要的框架或者类库。应用只要通过挂载，便可渲染自己的html页面，并自由实现功能。“挂载”(mounted)的概念指的是被注册的应用内容是否已展示在DOM上。我们可通过应用的<a href="#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0">activity function</a>来判断其是否已被挂载。应用在未挂载之前，会一直保持休眠状态。</p>
<p>在一个 single-spa 页面，注册的应用会经过下载(loaded)、初始化(initialized)、被挂载(mounted)、卸载(unmounted)和unloaded（被移除）等过程。single-spa会通过“生命周期”为这些过程提供钩子函数。
生命周期函数是 single-spa 在注册的应用上调用的一系列函数，single-spa 会在各应用的主文件中，查找对应的函数名并进行调用。所以注册的应用必须保证在其入口文件实现下面提到的各个生命周期函数。</p>
<ul>
<li><code>bootstrap</code>, <code>mount</code>, and <code>unmount</code>的实现是必须的，<code>unload</code>则是可选的</li>
<li>生命周期函数必须有返回值，可以是Promise或者<code>async</code>函数</li>
<li>如果导出的是函数数组而不是单个函数，这些函数会被依次调用，对于promise函数，会等到resolve之后再调用下一个函数</li>
<li>如果 single-spa <a href="api.md#start">未启动</a>，各个应用会被下载，但不会被初始化、挂载或卸载。</li>
</ul>
<blockquote>
<p><strong>注</strong></p>
<p>在<a href="ecosystem.md">single-spa 生态</a>中有各个主流框架对于生命周期函数的实现，这些文档有助于理解这些helper执行的操作，也有助于你自己实现生命周期函数。</p>
</blockquote>
<h3 id="生命周期参数">生命周期参数</h3>
<p>生命周期函数使用”props” 传参，这个对象包含single-spa相关信息和其他的自定义属性。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">bootstrap</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF">,        </span><span style="color: #7F848E">// 应用名称</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">singleSpa</span><span style="color: #ABB2BF">,   </span><span style="color: #7F848E">// singleSpa实例</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">mountParcel</span><span style="color: #ABB2BF">, </span><span style="color: #7F848E">// 手动挂载的函数</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">customProps</span><span style="color: #ABB2BF">  </span><span style="color: #7F848E">// 自定义属性</span></span>
<span class="line"><span style="color: #ABB2BF">  } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">;     </span><span style="color: #7F848E">// Props 会传给每个生命周期函数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h4 id="内置参数">内置参数</h4>
<p>每个生命周期函数的入参都会保证有如下参数：</p>
<ul>
<li><code>name</code>: 注册到 single-spa 的应用名称</li>
<li><code>singleSpa</code>: 对singleSpa 实例的引用, 方便各应用和类库调用singleSpa提供的API时不再导入它。 可以解决有多个webpack配置文件构建时无法保证只引用一个singleSpa实例的问题。</li>
<li><code>mountParcel</code>: <a href="/docs/parcels-api.html#mountparcel">mountParcel 函数</a>.</li>
</ul>
<h4 id="自定义参数">自定义参数</h4>
<p>除single-spa提供的内置参数外，还可以指定自定义参数，在调用各个生命周期函数时传入。指定方法是在调用<code>registerApplication</code>时，传入第4个参数。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #7F848E">// root.application.js</span></span>
<span class="line"><span style="color: #E5C07B">singleSpa</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">registerApplication</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'app1'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">activeWhen</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">customProps</span><span style="color: #ABB2BF">: { </span><span style="color: #E06C75">authToken</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"d83jD63UdZ6RS6f70D0"</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #E5C07B">singleSpa</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">registerApplication</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'app1'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">activeWhen</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">customProps</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">location</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">authToken</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"d83jD63UdZ6RS6f70D0"</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #7F848E">// app1.js</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">authToken</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E">// 可以在 app1 中获取到authToken参数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">reactLifecycles</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>可能使用到的场景：</p>
<ul>
<li>各个应用共享一个公共的 access token</li>
<li>下发初始化信息，如渲染目标</li>
<li>传递对事件总线（event bus）的引用，方便各应用之间进行通信
注意如果没有提供自定义参数，则<code>props.customProps</code>默认会返回一个空对象。</li>
</ul>
<h3 id="下载load">下载(load)</h3>
<p>注册的应用会被懒加载，这指的是该应用的代码会从服务器端下载并执行。注册的应用在<a href="#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0">activity function</a> 第一次返回真值(truthy value)时，下载动作会发生。在下载过程中，建议尽可能执行少的操作，可以在<code>bootstrap</code>生命周期之后再执行各项操作。若确实有在下载时需要执行的操作，可将代码放入子应用入口文件中，但要放在各导出函数的外部。例如：</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The registered application has been loaded!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">bootstrap</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {...}</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {...}</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">unmount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {...}</span></span></code></pre>
<h3 id="初始化">初始化</h3>
<p>这个生命周期函数会在应用<strong>第一次</strong>挂载前<strong>执行一次</strong>。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">bootstrap</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">then</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E">// One-time initialization code goes here</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'bootstrapped!'</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h3 id="挂载">挂载</h3>
<p>每当应用的<a href="#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0">activity function</a>返回真值，但该应用处于未挂载状态时，挂载的生命周期函数就会被调用。调用时，函数会根据URL来确定当前被激活的路由，创建DOM元素、监听DOM事件等以向用户呈现渲染的内容。任何子路由的改变（如<code>hashchange</code>或<code>popstate</code>等）不会再次触发<code>mount</code>，需要各应用自行处理。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">then</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E">// Do framework UI rendering here</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'mounted!'</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h3 id="卸载">卸载</h3>
<p>每当应用的<a href="#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0">activity function</a>返回假值，但该应用已挂载时，卸载的生命周期函数就会被调用。卸载函数被调用时，会清理在挂载应用时被创建的DOM元素、事件监听、内存、全局变量和消息订阅等。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">unmount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">then</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E">// Do framework UI unrendering here</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'unmounted!'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h3 id="移除">移除</h3>
<p>“移除”生命周期函数的实现是可选的，它只有在<a href="api.md#unloadapplication">unloadApplication</a>被调用时才会触发。如果一个已注册的应用没有实现这个生命周期函数，则假设这个应用无需被移除。
移除的目的是各应用在移除之前执行部分逻辑，一旦应用被移除，它的状态将会变成NOT_LOADED，下次激活时会被重新初始化。
移除函数的设计动机是对所有注册的应用实现“热下载”，不过在其他场景中也非常有用，比如想要重新初始化一个应用，且在重新初始化之前执行一些逻辑操作时。</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">unload</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">then</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E">// Hot-reloading implementation goes here</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'unloaded!'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h3 id="超时">超时</h3>
<p>默认情况下，所有注册的应用遵循<a href="/docs/api#setbootstrapmaxtime">全局超时配置</a>，但对于每个应用，也可以通过在主入口文件导出一个<code>timeouts</code>对象来重新定义超时时间。如：</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #7F848E">// app-1.main-entry.js</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">bootstrap</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {...}</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {...}</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">unmount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {...}</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">timeouts</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">bootstrap</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">millis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">5000</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">dieOnTimeout</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">warningMillis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2500</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">mount</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">millis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">5000</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">dieOnTimeout</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">warningMillis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2500</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">unmount</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">millis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">5000</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">dieOnTimeout</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">warningMillis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2500</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">unload</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">millis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">5000</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">dieOnTimeout</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">warningMillis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2500</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre>
<blockquote>
<p>注意<code>millis</code>指的是最终控制台输出警告的毫秒数，<code>warningMillis</code>指的是将警告打印到控制台(间隔)的毫秒数。</p>
</blockquote>
<h2 id="使用single-spa生态快速接入">使用single-spa生态快速接入</h2>
<p>single-spa官方团队针对不同流行框架创建了一些项目，帮助开发者使用自己选择的框架来创建single-spa应用。这里以React为例。</p>
<p>官方提供了<a href="https://github.com/single-spa/single-spa-react">single-spa-react</a>，为React应用提供了生命周期钩子。</p>
<p>来看一下案例，singleSpaReact最后返回的包含各生命周期函数的对象：</p>
<pre is:raw="" class="astro-code" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">React</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'react'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ReactDOM</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'react-dom'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rootComponent</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'./path-to-root-component.js'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #7F848E">// Note that SingleSpaContext is a react@16.3 (if available) context that provides the singleSpa props</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">singleSpaReact</span><span style="color: #ABB2BF">, {</span><span style="color: #E06C75">SingleSpaContext</span><span style="color: #ABB2BF">} </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'single-spa-react'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">reactLifecycles</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">singleSpaReact</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">React</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">ReactDOM</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">rootComponent</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">errorBoundary</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">info</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">props</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E">// https://reactjs.org/docs/error-boundaries.html</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> (</span></span>
<span class="line"><span style="color: #ABB2BF">      &#x3C;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">>This renders when a catastrophic error occurs&#x3C;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">></span></span>
<span class="line"><span style="color: #ABB2BF">    );</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bootstrap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">reactLifecycles</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">bootstrap</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">mount</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">reactLifecycles</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">mount</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">unmount</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">reactLifecycles</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">unmount</span><span style="color: #ABB2BF">;</span></span></code></pre>
<p>single-spa-react的源码不难，主要包括参数处理，和针对React框架的一些特点和语法实现了DOM的创建和插入，这里就不做过多分析，有兴趣的朋友可以自行阅读。</p>
<h2 id="参考">参考</h2>
<ol>
<li><a href="https://single-spa.js.org/docs/building-applications">single-spa building-applications</a></li>
<li><a href="https://single-spa.js.org/docs/configuration">COnfiguring single-spa</a></li>
</ol>
    </article>

    
  </main><footer class="max-w-screen-2xl mt-auto astro-RWWC6FBJ">
  <div class="footer-wrapper astro-RWWC6FBJ">
    <div class="social-icons flex astro-PHLHVEKU">
  <a type="button" href="https://github.com/zhanglun" tabindex="0" class="group link-button astro-PHLHVEKU astro-2C5NGGNE" title=" Astro blog facile on Github">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path
      d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
    ></path>
  </svg>
</a>

<a type="button" href="https://www.instagram.com/zhanglun1410/" tabindex="0" class="group link-button astro-PHLHVEKU astro-2C5NGGNE" title="Astro blog facile on Instagram">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <rect x="4" y="4" width="16" height="16" rx="4"></rect>
    <circle cx="12" cy="12" r="3"></circle>
    <line x1="16.5" y1="7.5" x2="16.5" y2="7.501"></line>
  </svg>
</a>

<a type="button" href="mailto:zhanglun1410@gmail.com" tabindex="0" class="group link-button astro-PHLHVEKU astro-2C5NGGNE" title="Send an email to Astro blog facile">
  <svg
      xmlns="http://www.w3.org/2000/svg"
      class="icon-tabler"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <rect x="3" y="5" width="18" height="14" rx="2"></rect>
      <polyline points="3 7 12 13 21 7"></polyline>
    </svg>
</a>

<a type="button" href="https://twitter.com/zhanglun1410" tabindex="0" class="group link-button astro-PHLHVEKU astro-2C5NGGNE" title="Astro blog facile on Twitter">
  <svg
      xmlns="http://www.w3.org/2000/svg"
      class="icon-tabler"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path>
    </svg>
</a>


</div>


    <div class="copyright-wrapper astro-RWWC6FBJ">
      <span class="astro-RWWC6FBJ">Copyright &#169; 2023</span>
      <span class="separator astro-RWWC6FBJ">&nbsp;|&nbsp;</span>
      <span class="astro-RWWC6FBJ">All rights reserved.</span>
    </div>
  </div>
</footer>


  </body></html>


